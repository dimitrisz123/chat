(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{103:function(e,t,n){},259:function(e,t,n){},260:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(14),s=n.n(o),c=(n(103),n(15)),u=n(16),i=n(18),l=n(17),m=n(19),p=n(29),d=n.n(p),g=n(28),h=n.n(g),f=n(46),b=n.n(f),E=n(47),y=n.n(E),O=n(30),v=n.n(O),j=n(45),R=n.n(j),I={button:{margin:"20px auto"}},S=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(i.a)(this,Object(l.a)(t).call(this))).onUsernameChangeHandler=function(t){e.setState({UsernameInput:t.target.value})},e.onPasswordChangeHandler=function(t){e.setState({PasswordInput:t.target.value})},e.onLoginPressButton=function(){fetch("https://chatback123.herokuapp.com/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userid:e.state.UsernameInput,pass:e.state.PasswordInput})}).then(function(e){return e.json()}).then(function(t){console.log(t,"login"),t.id&&(e.props.userHandler(t),e.props.changeRoute("app"))}).catch(function(e){return console.log("User not found")})},e.state={UsernameInput:"",PasswordInput:""},e}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(h.a,{container:!0,justify:"center",alignItems:"center",style:{height:"100vh",backgroundImage:"url(".concat(R.a,")"),backgroundSize:"cover"}},r.a.createElement(b.a,{style:{width:"300px"}},r.a.createElement(h.a,{container:!0,direction:"column",alignItems:"center",justify:"space-around"},r.a.createElement(y.a,{title:"Login"}),r.a.createElement(d.a,{label:"Username",style:{width:"200px"},type:"text",margin:"normal",onChange:this.onUsernameChangeHandler}),r.a.createElement(d.a,{label:"Password",style:{width:"200px"},type:"password",margin:"normal",onChange:this.onPasswordChangeHandler}),r.a.createElement(v.a,{onClick:this.onLoginPressButton,style:I.button,variant:"contained"},"Login"),r.a.createElement(v.a,{style:{marginBottom:"20px"},size:"small",color:"primary",onClick:function(){return e.props.changeRoute("register")}},"Click here to register"))))}}]),t}(a.Component),M={button:{margin:"20px auto"}},T=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(i.a)(this,Object(l.a)(t).call(this))).onUsernameChangeHandler=function(t){e.setState({UsernameInput:t.target.value})},e.onPasswordChangeHandler=function(t){e.setState({PasswordInput:t.target.value})},e.onRegisterPressed=function(){fetch("https://chatback123.herokuapp.com/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userid:e.state.UsernameInput,pass:e.state.PasswordInput})}).then(function(e){return e.json()}).then(function(t){t.id&&(e.props.userHandler(t),e.props.changeRoute("app"))}).catch(function(e){return console.log("Register failed")})},e.state={UsernameInput:"",PasswordInput:""},e}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(h.a,{container:!0,justify:"center",alignItems:"center",style:{height:"100vh",backgroundImage:"url(".concat(R.a,")"),backgroundSize:"cover"}},r.a.createElement(b.a,{style:{width:"300px"}},r.a.createElement(h.a,{container:!0,direction:"column",alignItems:"center",justify:"space-around"},r.a.createElement(y.a,{title:"Register"}),r.a.createElement(d.a,{label:"Username",style:{width:"200px"},type:"text",margin:"normal",onChange:this.onUsernameChangeHandler}),r.a.createElement(d.a,{label:"Password",style:{width:"200px"},type:"password",margin:"normal",onChange:this.onPasswordChangeHandler}),r.a.createElement(v.a,{onClick:this.onRegisterPressed,style:M.button,variant:"contained"},"Register"),r.a.createElement(v.a,{style:{marginBottom:"20px"},size:"small",color:"primary",onClick:function(){return e.props.changeRoute("login")}},"Click here to login"))))}}]),t}(a.Component),k=n(32),w=n(60),C=function(e){return r.a.createElement("div",{className:"add-room"},r.a.createElement("form",{onSubmit:e.createRoom},r.a.createElement("input",{placeholder:"Enter a room name",className:"input",type:"text",onChange:e.inputRoom,value:e.value})))},N=function(e){return r.a.createElement("div",{className:"message-list"},e.messages.map(function(e,t){return r.a.createElement("div",{className:"message",key:t},r.a.createElement("div",{className:"message-username"},e.senderId),r.a.createElement("div",{className:"message-text"},e.parts[0].payload.content))}))},U=function(e){var t=e.sendMessage,n=e.inputMessage,a=e.value,o=e.disabled;return r.a.createElement("form",{className:"input",onSubmit:t},r.a.createElement("input",{placeholder:"Enter a message",className:"input",type:"text",onChange:n,value:a,disabled:o}))},_=function(e){function t(){return Object(c.a)(this,t),Object(i.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=Object(k.a)(this.props.rooms).sort(function(e,t){return e.id-t.id});return r.a.createElement("div",{className:"rooms-list"},r.a.createElement("ul",null,t.map(function(t,n){return r.a.createElement("li",{className:"room",key:n},r.a.createElement("a",{onClick:function(){return e.props.subscribeToRoom(t.id)},href:"# "},t.name))})))}}]),t}(r.a.Component),P=n(27),x=function(e){return"message"===e?{type:"CLEAR_MESSAGE_INPUT"}:"room"===e?{type:"CLEAR_ROOM_INPUT"}:void 0},H=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(i.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(r)))).subscribeToRoom=function(e){n.props.allMessages([]),n.props.getRoomId(e),n.currentUser.subscribeToRoomMultipart({roomId:e,hooks:{onMessage:function(e){n.props.allMessages([].concat(Object(k.a)(n.props.messages),[e]))}},messageLimit:10}).catch(function(e){return console.log("something went wrong")})},n.getAllRooms=function(){n.currentUser.getJoinableRooms().then(function(e){n.props.allRooms([].concat(Object(k.a)(e),Object(k.a)(n.currentUser.rooms)))}).catch(function(e){console.log("Error getting joinable rooms: ".concat(e))})},n.createRoom=function(e){e.preventDefault(),n.currentUser.createRoom({name:n.props.roomName}).then(function(e){e&&(n.props.clearRoomInput(),n.getAllRooms(),n.subscribeToRoom(e.id))}).catch(function(e){console.log("Error creating room ".concat(e))})},n.sendMessage=function(e){e.preventDefault(),n.currentUser.sendSimpleMessage({text:n.props.inputMessage,roomId:n.props.roomid}).then(function(e){console.log(e),e&&n.props.clearMessageInput()}).catch(function(e){console.log("Error adding message to my room: ".concat(e))})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;new w.ChatManager({instanceLocator:"v1:us1:70765878-2ac8-4e66-938d-b18c7503aded",userId:this.props.user.id,tokenProvider:new w.TokenProvider({url:"https://chatback123.herokuapp.com/auth"})}).connect().then(function(t){e.currentUser=t,e.getAllRooms();var n=t.cursorsInstance.tokenProvider.cachedToken;sessionStorage.setItem("JWT",n)}).catch(function(e){console.log("Error on connection",e)})}},{key:"render",value:function(){var e=this.props,t=e.onInputMessage,n=e.onInputRoom,a=e.roomName,o=e.inputMessage,s=e.rooms,c=e.messages,u=e.roomid;return r.a.createElement("div",{className:"app"},r.a.createElement("div",{className:"top-row"},r.a.createElement(_,{subscribeToRoom:this.subscribeToRoom,rooms:s}),r.a.createElement(N,{messages:c})),r.a.createElement("div",{className:"bottom-row"},r.a.createElement(C,{createRoom:this.createRoom,inputRoom:n,value:a}),r.a.createElement(U,{disabled:!u,sendMessage:this.sendMessage,inputMessage:t,value:o})))}}]),t}(a.Component),A=Object(P.b)(function(e){return{inputMessage:e.reducer1.inputMessage,roomName:e.reducer1.roomName,messages:e.reducer1.messages,rooms:e.reducer1.rooms,roomid:e.reducer1.roomid}},function(e){return{onInputMessage:function(t){return e({type:"SET_MESSAGE",payload:t.target.value})},onInputRoom:function(t){return e({type:"SET_ROOM",payload:t.target.value})},allMessages:function(t){return e({type:"GET_MESSAGES",payload:t})},allRooms:function(t){return e({type:"GET_ROOMS",payload:t})},getRoomId:function(t){return e(function(e){return{type:"GET_ROOM_ID",payload:e}}(t))},clearMessageInput:function(){return e(x("message"))},clearRoomInput:function(){return e(x("room"))}}})(H),G=(n(259),function(e){function t(){return Object(c.a)(this,t),Object(i.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;fetch("https://chatback123.herokuapp.com/");var t=sessionStorage.getItem("JWT");t&&fetch("https://chatback123.herokuapp.com/user_id_from_JWT",{method:"POST",headers:{"Content-Type":"application/json",Authorization:t}}).then(function(e){return e.json()}).then(function(t){e.props.userHandler(t),e.props.changeRouteHandler("app")}).catch(function(e){return console.log("error JWT")})}},{key:"render",value:function(){var e,t=this.props,n=t.changeRouteHandler,a=t.userHandler,o=t.user,s=t.route;return"register"===s?e=r.a.createElement(T,{changeRoute:n,userHandler:a}):"login"===s?e=r.a.createElement(S,{userHandler:a,changeRoute:n}):"app"===s&&(e=r.a.createElement(A,{user:o})),r.a.createElement("div",null,e)}}]),t}(a.Component)),L=Object(P.b)(function(e){return{route:e.reducer1.route,user:e.reducer1.user}},function(e){return{changeRouteHandler:function(t){return e(function(e){return{type:"SET_ROUTE",payload:e}}(t))},userHandler:function(t){return e({type:"SET_USER",payload:t})}}})(G),J=n(97),D=n.n(J),z=n(31),B={inputMessage:"",roomName:"",route:"login",user:"",messages:[],rooms:[],roomid:null},W=Object(z.c)({reducer1:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t.type){case"SET_MESSAGE":return Object.assign({},e,{inputMessage:t.payload});case"SET_ROOM":return Object.assign({},e,{roomName:t.payload});case"SET_ROUTE":return Object.assign({},e,{route:t.payload});case"SET_USER":return Object.assign({},e,{user:t.payload});case"GET_MESSAGES":return Object.assign({},e,{messages:t.payload});case"GET_ROOMS":return Object.assign({},e,{rooms:t.payload});case"GET_ROOM_ID":return Object.assign({},e,{roomid:t.payload});case"CLEAR_MESSAGE_INPUT":return Object.assign({},e,{inputMessage:B.inputMessage});case"CLEAR_ROOM_INPUT":return Object.assign({},e,{roomName:B.roomName});default:return e}}}),q=Object(z.d)(W,Object(z.a)(D.a));s.a.render(r.a.createElement(P.a,{store:q},r.a.createElement(L,null)),document.getElementById("root"))},45:function(e,t,n){e.exports=n.p+"static/media/photo1.aa57deaa.jpg"},98:function(e,t,n){e.exports=n(260)}},[[98,1,2]]]);
//# sourceMappingURL=main.7bd38707.chunk.js.map